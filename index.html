<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>入場管理アプリ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2196F3">
</head>
<body>
    <!-- ヘッダー -->
    <header class="header">
        <h1>🎫 入場管理アプリ</h1>
        <div class="header-buttons">
            <button id="updateBtn" class="update-btn">📥 データ更新</button>
            <button id="menuBtn" class="update-btn">📋 データ管理</button>
        </div>
    </header>

    <!-- メイン画面 -->
    <main class="main" id="mainScreen">
        <div class="card">
            <h2>QRコードをスキャン</h2>
            <button id="startQRScan" class="scan-btn">📷 QRコード読み取り</button>
            <button id="manualEntry" class="scan-btn" style="background: linear-gradient(45deg, #FF9800, #FFB74D); margin-top: 1rem;">📝 手動でチケット番号入力</button>
        </div>
        
        <div class="card">
            <h3>📊 本日の状況</h3>
            <div id="stats" class="stats">
                <div class="stat-item">
                    <div class="stat-number">0</div>
                    <div class="stat-label">入場者数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">0</div>
                    <div class="stat-label">総チケット数</div>
                </div>
            </div>
        </div>
    </main>

    <!-- データ管理メニュー画面 -->
    <div class="screen hidden" id="dataMenuScreen">
        <div class="scan-header">
            <button id="backToMainFromMenu" class="back-btn">← 戻る</button>
            <h2>📋 データ管理</h2>
        </div>
        <div class="menu-grid">
            <button id="viewCustomersBtn" class="menu-item">
                <div class="menu-icon">👥</div>
                <div class="menu-title">顧客データ一覧</div>
                <div class="menu-desc">全顧客データを表示</div>
            </button>
            <button id="viewEntriesBtn" class="menu-item">
                <div class="menu-icon">📋</div>
                <div class="menu-title">入場記録一覧</div>
                <div class="menu-desc">入場履歴を表示</div>
            </button>
            <button id="exportDataBtn" class="menu-item">
                <div class="menu-icon">💾</div>
                <div class="menu-title">データエクスポート</div>
                <div class="menu-desc">CSVでダウンロード</div>
            </button>
            <button id="clearDataBtn" class="menu-item danger">
                <div class="menu-icon">🗑️</div>
                <div class="menu-title">データクリア</div>
                <div class="menu-desc">入場記録をリセット</div>
            </button>
        </div>
    </div>

    <!-- 顧客データ一覧画面 -->
    <div class="screen hidden" id="customerListScreen">
        <div class="scan-header">
            <button id="backToMenuFromCustomers" class="back-btn">← 戻る</button>
            <h2>👥 顧客データ一覧</h2>
        </div>
        <div class="list-controls">
            <input type="text" id="customerSearchInput" class="search-input" placeholder="名前、チケット番号、メールで検索...">
            <select id="customerFilterSelect" class="filter-select">
                <option value="all">全て表示</option>
                <option value="entered">入場済み</option>
                <option value="not-entered">未入場</option>
            </select>
        </div>
        <div class="list-stats">
            <span id="customerListStats">顧客データを読み込み中...</span>
        </div>
        <div id="customerList" class="data-list"></div>
    </div>

    <!-- 入場記録一覧画面 -->
    <div class="screen hidden" id="entryListScreen">
        <div class="scan-header">
            <button id="backToMenuFromEntries" class="back-btn">← 戻る</button>
            <h2>📋 入場記録一覧</h2>
        </div>
        <div class="list-controls">
            <input type="text" id="entrySearchInput" class="search-input" placeholder="名前、チケット番号で検索...">
            <input type="date" id="entryDateFilter" class="date-filter">
        </div>
        <div class="list-stats">
            <span id="entryListStats">入場記録を読み込み中...</span>
        </div>
        <div id="entryList" class="data-list"></div>
    </div>

    <!-- QRスキャン画面 -->
    <div class="screen hidden" id="qrScanScreen">
        <div class="scan-header">
            <button id="stopQRScan" class="back-btn">← 戻る</button>
            <h2>QRコード読み取り</h2>
        </div>
        <div id="qrReader" style="width: 100%;"></div>
        <p id="qrScanStatus" class="scan-status">QRコードをカメラに向けてください</p>
        <button id="switchToManual" class="camera-btn" style="margin-top: 1rem;">📝 手動入力に切り替え</button>
    </div>
    
    <!-- QRスキャン画面内に追加 -->
<div class="scan-controls"> 
    <button id="pauseResumeBtn" style="margin: 8px; padding: 12px 20px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; background: #FF9800; color: white;">
        ⏸️ 一時停止
    </button>
    <button id="continuousModeBtn" style="margin: 8px; padding: 12px 20px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; background: #4CAF50; color: white;">
        🔄 連続スキャン: ON
    </button>
</div>


    <!-- 手動入力画面 -->
    <div class="screen hidden" id="manualEntryScreen">
        <div class="scan-header">
            <button id="backToMain" class="back-btn">← 戻る</button>
            <h2>手動検索</h2>
        </div>
        <div class="manual-input">
            <h3>🔍 顧客検索</h3>
            <p>チケット番号、名前、メールアドレスで検索できます</p>
            <input type="text" id="searchInput" class="ticket-input" placeholder="チケット番号または名前を入力">
            <button id="searchButton" class="search-btn">🔍 検索</button>
            <div class="test-numbers">
                <p><strong>テスト用チケット番号:</strong> 634, 183, 631</p>
            </div>
        </div>
        <div id="searchResult"></div>
    </div>

    <!-- 顧客情報画面 -->
    <div class="screen hidden" id="customerInfoScreen">
        <div class="customer-header">
            <button id="backToSearch" class="back-btn">← 戻る</button>
            <h2>👤 顧客情報</h2>
        </div>
        
        <div class="customer-info">
            <div class="info-item">
                <span class="label">チケット番号:</span>
                <span id="customerTicket">-</span>
            </div>
            <div class="info-item">
                <span class="label">お名前:</span>
                <span id="customerName">-</span>
            </div>
            <div class="info-item">
                <span class="label">メールアドレス:</span>
                <span id="customerEmail">-</span>
            </div>
            <div class="info-item">
                <span class="label">購入枚数:</span>
                <span id="customerTickets">-</span>
            </div>
            <div class="info-item">
                <span class="label">座席番号:</span>
                <span id="customerSeat">-</span>
            </div>
        </div>

        <!-- 入場履歴表示 -->
        <div id="entryHistory" class="entry-history hidden">
            <h3>📝 入場履歴</h3>
            <div id="entryHistoryList"></div>
        </div>

        <div class="entry-section">
            <h3>入場処理</h3>
            <div class="input-group">
                <label for="entryCountInput">入場人数:</label>
                <input type="number" id="entryCountInput" min="1" max="10" value="1">
            </div>
            <button id="confirmEntry" class="entry-btn">✅ 入場を確定</button>
        </div>
    </div>

    <!-- 完了画面 -->
    <div class="screen hidden" id="completionScreen">
        <div class="complete-content">
            <div class="success-icon">✅</div>
            <h2>入場完了</h2>
            <div class="completion-details">
                <p><strong>お名前:</strong> <span id="completedCustomerName">-</span></p>
                <p><strong>チケット番号:</strong> <span id="completedTicketNumber">-</span></p>
                <p><strong>入場人数:</strong> <span id="completedTickets">-</span></p>
                <p><strong>入場時刻:</strong> <span id="entryTime">-</span></p>
            </div>
            <button id="nextCustomer" class="next-btn">次の顧客を処理</button>
        </div>
    </div>

    <!-- ローディング -->
    <div class="loading hidden" id="loading">
        <div class="spinner"></div>
        <p>処理中...</p>
    </div>

    <!-- QRコードライブラリ -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="script.js"></script>
</body>
</html>

