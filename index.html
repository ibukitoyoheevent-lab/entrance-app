<!DOCTYPE html>
<html lang="ja" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>å…¥å ´ç®¡ç†ã‚¢ãƒ—ãƒª</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2196F3">
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <style>
    /* ãƒªã‚»ãƒƒãƒˆã¨ãƒ™ãƒ¼ã‚¹è¨­å®š */
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 12px;
      color: #333;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ã‚³ãƒ³ãƒ†ãƒŠ */
    .container {
      max-width: 480px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 24px 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(10px);
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
      text-align: center;
      margin-bottom: 32px;
      padding-bottom: 20px;
      border-bottom: 3px solid #e9ecef;
    }

    .header h1 {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 700;
      color: #2196f3;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header-buttons {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* ãƒœã‚¿ãƒ³ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
    button {
      border: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      min-height: 48px;
      padding: 12px 20px;
      position: relative;
      overflow: hidden;
      -webkit-user-select: none;
      user-select: none;
      touch-action: manipulation;
    }

    /* ãƒœã‚¿ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    button:active {
      transform: translateY(2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    /* ãƒ—ãƒ©ã‚¤ãƒãƒªãƒœã‚¿ãƒ³ */
    .btn-primary {
      background: linear-gradient(145deg, #2196f3, #1976d2);
      color: white;
      box-shadow: 0 4px 16px rgba(33, 150, 243, 0.3);
      min-height: 56px;
      font-size: 1.1rem;
    }

    .btn-primary:hover {
      background: linear-gradient(145deg, #1976d2, #1565c0);
      box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
      transform: translateY(-2px);
    }

    /* ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒœã‚¿ãƒ³ */
    .btn-secondary {
      background: linear-gradient(145deg, #ff9800, #f57c00);
      color: white;
      box-shadow: 0 4px 16px rgba(255, 152, 0, 0.3);
      min-height: 56px;
      font-size: 1.1rem;
    }

    .btn-secondary:hover {
      background: linear-gradient(145deg, #f57c00, #ef6c00);
      box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
      transform: translateY(-2px);
    }

    /* æˆåŠŸãƒœã‚¿ãƒ³ */
    .btn-success {
      background: linear-gradient(145deg, #4caf50, #388e3c);
      color: white;
      box-shadow: 0 4px 16px rgba(76, 175, 80, 0.3);
    }

    .btn-success:hover {
      background: linear-gradient(145deg, #388e3c, #2e7d32);
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
      transform: translateY(-2px);
    }

    /* è­¦å‘Šãƒœã‚¿ãƒ³ */
    .btn-warning {
      background: linear-gradient(145deg, #ff9800, #f57c00);
      color: white;
      box-shadow: 0 4px 16px rgba(255, 152, 0, 0.3);
    }

    .btn-warning:hover {
      background: linear-gradient(145deg, #f57c00, #ef6c00);
      transform: translateY(-2px);
    }

    /* å±é™ºãƒœã‚¿ãƒ³ */
    .btn-danger {
      background: linear-gradient(145deg, #f44336, #d32f2f);
      color: white;
      box-shadow: 0 4px 16px rgba(244, 67, 54, 0.3);
    }

    .btn-danger:hover {
      background: linear-gradient(145deg, #d32f2f, #c62828);
      transform: translateY(-2px);
    }

    /* å°ã•ã„ãƒœã‚¿ãƒ³ */
    .btn-small {
      min-height: 40px;
      padding: 8px 16px;
      font-size: 0.9rem;
    }

    /* å¤§ãã„ãƒœã‚¿ãƒ³ */
    .btn-large {
      min-height: 64px;
      padding: 16px 32px;
      font-size: 1.2rem;
      font-weight: 700;
    }

    /* å…¨å¹…ãƒœã‚¿ãƒ³ */
    .btn-full {
      width: 100%;
      margin: 8px 0;
    }

    /* ã‚«ãƒ¼ãƒ‰ */
    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .card h2,
    .card h3 {
      margin: 0 0 20px 0;
      color: #2196f3;
      text-align: center;
      font-weight: 600;
    }

    .card h2 {
      font-size: 1.4rem;
    }

    .card h3 {
      font-size: 1.2rem;
    }

    /* çµ±è¨ˆè¡¨ç¤º */
    .stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      text-align: center;
    }

    .stat-item {
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      padding: 20px 16px;
      border-radius: 12px;
      border: 2px solid #e9ecef;
    }

    .stat-number {
      font-size: 2.2rem;
      font-weight: 800;
      color: #2196f3;
      margin-bottom: 8px;
      line-height: 1;
    }

    .stat-label {
      font-size: 0.95rem;
      color: #666;
      font-weight: 600;
    }

    /* ç”»é¢ç®¡ç† */
    .screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 1000;
      padding: 12px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .screen .container {
      min-height: calc(100vh - 24px);
      display: flex;
      flex-direction: column;
    }

    .hidden {
      display: none !important;
    }

    /* ç”»é¢ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .screen-header {
      display: flex;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #e9ecef;
      gap: 16px;
    }

    .screen-header h2 {
      margin: 0;
      flex: 1;
      text-align: center;
      color: #2196f3;
      font-size: 1.4rem;
      font-weight: 600;
    }

    /* QRã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€ãƒ¼ */
    #qrReader {
      width: 100%;
      max-width: 360px;
      margin: 0 auto 24px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    /* ã‚¹ã‚­ãƒ£ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
    .scan-controls {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .scan-controls > button {
      margin: 6px;
      min-width: 120px;
    }

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
    .scan-status {
      text-align: center;
      margin: 20px 0;
      padding: 16px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }

    .scan-status.scanning {
      color: #2196f3;
      border-color: #2196f3;
      background: rgba(33, 150, 243, 0.1);
    }

    .scan-status.success {
      color: #4caf50;
      border-color: #4caf50;
      background: rgba(76, 175, 80, 0.1);
    }

    .scan-status.error {
      color: #f44336;
      border-color: #f44336;
      background: rgba(244, 67, 54, 0.1);
    }

    .scan-status.paused {
      color: #ff9800;
      border-color: #ff9800;
      background: rgba(255, 152, 0, 0.1);
    }

    /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
      font-size: 1rem;
    }

    input[type='text'],
    input[type='number'],
    input[type='search'],
    input[type='date'] {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      font-size: 1.1rem;
      background: white;
      transition: all 0.2s ease;
      min-height: 48px;
    }

    input:focus {
      outline: none;
      border-color: #2196f3;
      box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
    }

    .search-input {
      text-align: center;
      font-weight: 600;
    }

    /* é¡§å®¢æƒ…å ±è¡¨ç¤º */
    .customer-info {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid #f0f0f0;
      font-size: 1rem;
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 600;
      color: #555;
      min-width: 120px;
    }

    .info-value {
      font-weight: 500;
      color: #333;
      text-align: right;
      flex: 1;
    }

    /* ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .entry-section {
      background: linear-gradient(145deg, #4caf50, #45a049);
      color: white;
      border-radius: 16px;
      padding: 24px;
      margin-top: 20px;
      box-shadow: 0 6px 24px rgba(76, 175, 80, 0.3);
    }

    .entry-section h3 {
      color: white;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.2rem;
    }

    .entry-section .input-group input {
      background: white;
      color: #333;
      text-align: center;
      font-weight: 700;
      font-size: 1.3rem;
    }

    .entry-section button {
      background: white;
      color: #4caf50;
      font-weight: 700;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    /* å®Œäº†ç”»é¢ */
    .complete-content {
      text-align: center;
      padding: 40px 24px;
      background: linear-gradient(145deg, #4caf50, #45a049);
      color: white;
      border-radius: 20px;
      margin: 20px 0;
      box-shadow: 0 8px 32px rgba(76, 175, 80, 0.4);
    }

    .success-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%,
      100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }

    .completion-details {
      margin: 20px 0;
      text-align: left;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 12px;
    }

    .completion-details p {
      margin: 12px 0;
      font-weight: 500;
    }

    /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚°ãƒªãƒƒãƒ‰ */
    .menu-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 24px;
    }

    .menu-item {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 16px;
      padding: 20px 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .menu-item:hover {
      border-color: #2196f3;
      box-shadow: 0 4px 20px rgba(33, 150, 243, 0.15);
      transform: translateY(-2px);
    }

    .menu-item.danger {
      border-color: #f44336;
      color: #f44336;
    }

    .menu-item.danger:hover {
      border-color: #d32f2f;
      box-shadow: 0 4px 20px rgba(244, 67, 54, 0.15);
    }

    .menu-icon {
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .menu-title {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 4px;
      line-height: 1.2;
    }

    .menu-desc {
      font-size: 0.8rem;
      color: #666;
      line-height: 1.2;
    }

    /* ãƒªã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
    .list-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .list-stats {
      margin-bottom: 20px;
      font-weight: 600;
      color: #666;
      text-align: center;
      padding: 12px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 8px;
    }

    /* ãƒ‡ãƒ¼ã‚¿ãƒªã‚¹ãƒˆ */
    .data-list {
      max-height: 60vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .list-item {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .list-item:hover {
      border-color: #2196f3;
      box-shadow: 0 4px 16px rgba(33, 150, 243, 0.1);
    }

    .list-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .customer-name {
      font-weight: 600;
      font-size: 1.1rem;
      color: #333;
    }

    .entry-status {
      font-size: 0.8rem;
      padding: 4px 12px;
      border-radius: 16px;
      font-weight: 600;
    }

    .entry-status.entered {
      background: #d4edda;
      color: #155724;
    }

    .entry-status.pending {
      background: #fff3cd;
      color: #856404;
    }

    .list-item-details {
      font-size: 0.9rem;
      color: #666;
      line-height: 1.4;
    }

    /* æ¤œç´¢çµæœ */
    .search-result {
      margin-top: 20px;
    }

    .customer-result {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .customer-result:hover {
      border-color: #2196f3;
      box-shadow: 0 4px 16px rgba(33, 150, 243, 0.1);
    }

    /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
    .no-results,
    .no-data {
      text-align: center;
      color: #666;
      padding: 40px 20px;
      font-style: italic;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
    }

    /* ãƒ†ã‚¹ãƒˆç•ªå· */
    .test-numbers {
      margin-top: 20px;
      padding: 16px;
      background: rgba(33, 150, 243, 0.1);
      border-radius: 12px;
      font-size: 0.9rem;
      text-align: center;
      border: 1px solid rgba(33, 150, 243, 0.2);
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      color: white;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }

      .container {
        padding: 16px 12px;
      }

      .menu-grid {
        grid-template-columns: 1fr;
      }

      .menu-item {
        min-height: 100px;
      }

      .stats {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .header h1 {
        font-size: 1.5rem;
      }

      .screen-header {
        flex-wrap: wrap;
        text-align: center;
      }

      .list-item-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .info-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .info-value {
        text-align: left;
      }
    }

    /* æ¨ªå‘ãå¯¾å¿œ */
    @media (orientation: landscape) and (max-height: 500px) {
      .complete-content {
        padding: 20px;
      }

      .success-icon {
        font-size: 3rem;
        margin-bottom: 12px;
      }

      #qrReader {
        max-width: 280px;
        margin-bottom: 16px;
      }
    }

    /* ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹æœ€é©åŒ– */
    @media (pointer: coarse) {
      button {
        min-height: 48px;
        padding: 12px 20px;
      }

      .btn-large {
        min-height: 56px;
      }

      input {
        min-height: 48px;
        font-size: 16px; /* ã‚ºãƒ¼ãƒ é˜²æ­¢ */
      }
    }
  </style>
</head>
<body>
  <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
  <div class="container" id="mainScreen">
    <div class="header">
      <h1>ğŸ« å…¥å ´ç®¡ç†ã‚¢ãƒ—ãƒª</h1>
      <div class="header-buttons">
        <button id="updateBtn" class="btn-success btn-small">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>
        <button id="menuBtn" class="btn-success btn-small">ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</button>
      </div>
    </div>

    <div class="card">
      <h2>QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³</h2>
      <button id="startQRScan" class="btn-primary btn-large btn-full">ğŸ“· QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Š</button>
      <button id="manualEntry" class="btn-secondary btn-large btn-full">ğŸ“ æ‰‹å‹•ã§ãƒã‚±ãƒƒãƒˆç•ªå·å…¥åŠ›</button>
    </div>

    <div class="card">
      <h3>ğŸ“Š æœ¬æ—¥ã®çŠ¶æ³</h3>
      <div id="stats" class="stats">
        <div class="stat-item">
          <div class="stat-number" id="entryCount">0</div>
          <div class="stat-label">å…¥å ´è€…æ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="totalTickets">0</div>
          <div class="stat-label">ç·ãƒã‚±ãƒƒãƒˆæ•°</div>
        </div>
      </div>
    </div>
  </div>

  <!-- QRã‚¹ã‚­ãƒ£ãƒ³ç”»é¢ -->
  <div class="screen hidden" id="qrScanScreen">
    <div class="container">
      <div class="screen-header">
        <button id="stopQRScan" class="btn-danger btn-small">â† æˆ»ã‚‹</button>
        <h2>QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Š</h2>
      </div>

      <div id="qrReader"></div>
      <p id="qrScanStatus" class="scan-status">QRã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã¦ãã ã•ã„</p>

      <div class="scan-controls">
        <button id="pauseResumeBtn" class="btn-warning">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
        <button id="continuousModeBtn" class="btn-success">ğŸ”„ é€£ç¶šã‚¹ã‚­ãƒ£ãƒ³: ON</button>
        <button id="switchToManual" class="btn-secondary btn-full">ğŸ“ æ‰‹å‹•å…¥åŠ›ã«åˆ‡ã‚Šæ›¿ãˆ</button>
      </div>
    </div>
  </div>

  <!-- æ‰‹å‹•å…¥åŠ›ç”»é¢ -->
  <div class="screen hidden" id="manualEntryScreen">
    <div class="container">
      <div class="screen-header">
        <button id="backToMain" class="btn-danger btn-small">â† æˆ»ã‚‹</button>
        <h2>æ‰‹å‹•æ¤œç´¢</h2>
      </div>

      <div class="card">
        <h3>ğŸ” é¡§å®¢æ¤œç´¢</h3>
        <p style="text-align: center; margin-bottom: 20px; color: #666">
          ãƒã‚±ãƒƒãƒˆç•ªå·ã€åå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§æ¤œç´¢ã§ãã¾ã™
        </p>

        <div class="input-group">
          <input type="text" id="searchInput" class="search-input" placeholder="ãƒã‚±ãƒƒãƒˆç•ªå·ã¾ãŸã¯åå‰ã‚’å…¥åŠ›">
        </div>

        <button id="searchButton" class="btn-primary btn-large btn-full">ğŸ” æ¤œç´¢</button>

        <div class="test-numbers">
          <p><strong>ãƒ†ã‚¹ãƒˆç”¨ãƒã‚±ãƒƒãƒˆç•ªå·:</strong> 634, 183, 631</p>
        </div>
      </div>

      <div id="searchResult" class="search-result"></div>
    </div>
  </div>

  <!-- é¡§å®¢æƒ…å ±ç”»é¢ -->
  <div class="screen hidden" id="customerInfoScreen">
    <div class="container">
      <div class="screen-header">
        <button id="backToSearch" class="btn-danger btn-small">â† æˆ»ã‚‹</button>
        <h2>ğŸ‘¤ é¡§å®¢æƒ…å ±</h2>
      </div>

      <div class="customer-info">
        <div class="info-item">
          <span class="info-label">ãƒã‚±ãƒƒãƒˆç•ªå·:</span>
          <span id="customerTicket" class="info-value">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">ãŠåå‰:</span>
          <span id="customerName" class="info-value">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</span>
          <span id="customerEmail" class="info-value">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">è³¼å…¥æšæ•°:</span>
          <span id="customerTickets" class="info-value">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">åº§å¸­ç•ªå·:</span>
          <span id="customerSeat" class="info-value">-</span>
        </div>
      </div>

      <div id="entryHistory" class="card hidden">
        <h3>ğŸ“ å…¥å ´å±¥æ­´</h3>
        <div id="entryHistoryList"></div>
      </div>

      <div class="entry-section">
        <h3>å…¥å ´å‡¦ç†</h3>
        <div class="input-group">
          <label for="entryCountInput">å…¥å ´äººæ•°:</label>
          <input type="number" id="entryCountInput" min="1" max="10" value="1">
        </div>
        <button id="confirmEntry" class="btn-full">âœ… å…¥å ´ã‚’ç¢ºå®š</button>
      </div>
    </div>
  </div>

  <!-- å®Œäº†ç”»é¢ -->
  <div class="screen hidden" id="completionScreen">
    <div class="container">
      <div class="complete-content">
        <div class="success-icon">âœ…</div>
        <h2>å…¥å ´å®Œäº†</h2>
        <div class="completion-details">
          <p><strong>ãŠåå‰:</strong> <span id="completedCustomerName">-</span></p>
          <p><strong>ãƒã‚±ãƒƒãƒˆç•ªå·:</strong> <span id="completedTicketNumber">-</span></p>
          <p><strong>å…¥å ´äººæ•°:</strong> <span id="completedTickets">-</span></p>
          <p><strong>å…¥å ´æ™‚åˆ»:</strong> <span id="entryTime">-</span></p>
        </div>
        <button id="nextCustomer" class="btn-full">æ¬¡ã®é¡§å®¢ã‚’å‡¦ç†</button>
      </div>
    </div>
  </div>

  <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ -->
  <div class="screen hidden" id="dataMenuScreen">
    <div class="container">
      <div class="screen-header">
        <button id="backToMainFromMenu" class="btn-danger btn-small">â† æˆ»ã‚‹</button>
        <h2>ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
      </div>

      <div class="menu-grid">
        <button id="viewCustomersBtn" class="menu-item">
          <div class="menu-icon">ğŸ‘¥</div>
          <div class="menu-title">é¡§å®¢ãƒ‡ãƒ¼ã‚¿ä¸€è¦§</div>
          <div class="menu-desc">å…¨é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º</div>
        </button>
        <button id="viewEntriesBtn" class="menu-item">
          <div class="menu-icon">ğŸ“‹</div>
          <div class="menu-title">å…¥å ´è¨˜éŒ²ä¸€è¦§</div>
          <div class="menu-desc">å…¥å ´å±¥æ­´ã‚’è¡¨ç¤º</div>
        </button>
        <button id="exportDataBtn" class="menu-item">
          <div class="menu-icon">ğŸ’¾</div>
          <div class="menu-title">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</div>
          <div class="menu-desc">CSVã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</div>
        </button>
        <button id="clearDataBtn" class="menu-item danger">
          <div class="menu-icon">ğŸ—‘ï¸</div>
          <div class="menu-title">ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</div>
          <div class="menu-desc">å…¥å ´è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆ</div>
        </button>
      </div>
    </div>
  </div>

  <!-- é¡§å®¢ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ç”»é¢ -->
  <div class="screen hidden" id="customerListScreen">
    <div class="container">
      <div class="screen-header">
        <button id="backToMenuFromCustomers" class="btn-danger btn-small">â† æˆ»ã‚‹</button>
        <h2>ğŸ‘¥ é¡§å®¢ãƒ‡ãƒ¼ã‚¿ä¸€è¦§</h2>
      </div>

      <div class="list-controls">
        <input type="search" id="customerSearchInput" class="search-input" placeholder="åå‰ã€ãƒã‚±ãƒƒãƒˆç•ªå·ã€ãƒ¡ãƒ¼ãƒ«ã§æ¤œç´¢...">
        <select id="customerFilterSelect" class="filter-select">
          <option value="all">å…¨ã¦è¡¨ç¤º</option>
          <option value="entered">å…¥å ´æ¸ˆã¿</option>
          <option value="not-entered">æœªå…¥å ´</option>
        </select>
      </div>

      <div class="list-stats">
        <span id="customerListStats">é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
      </div>

      <div id="customerList" class="data-list"></div>
    </div>
  </div>

  <!-- å…¥å ´è¨˜éŒ²ä¸€è¦§ç”»é¢ -->
  <div class="screen hidden" id="entryListScreen">
    <div class="container">
      <div class="screen-header">
        <button id="backToMenuFromEntries" class="btn-danger btn-small">â† æˆ»ã‚‹</button>
        <h2>ğŸ“‹ å…¥å ´è¨˜éŒ²ä¸€è¦§</h2>
      </div>

      <div class="list-controls">
        <input type="search" id="entrySearchInput" class="search-input" placeholder="åå‰ã€ãƒã‚±ãƒƒãƒˆç•ªå·ã§æ¤œç´¢...">
        <input type="date" id="entryDateFilter" class="date-filter">
      </div>

      <div class="list-stats">
        <span id="entryListStats">å…¥å ´è¨˜éŒ²ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
      </div>

      <div id="entryList" class="data-list"></div>
    </div>
  </div>

  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
  <div class="loading hidden" id="loading">
    <div class="spinner"></div>
    <p>å‡¦ç†ä¸­...</p>
  </div>

  <script>
    // å…¥å ´ç®¡ç†ã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³è¨­å®š
    const CONFIG = {
      GOOGLE_APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzhMroDqsp9_fNtxRoj9Qcl39iY2YXGQdc5HxT0AFbEppDLz2kguHQGgmxB6nig-S-W/exec',
      STORAGE_KEY: 'entryManagementData',
      CUSTOMER_STORAGE_KEY: 'customerData'
    };

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let html5QrCode = null;
    let customerData = [];
    let entryData = [];
    let isScanning = false;
    let isPaused = false;
    let continuousScanMode = true;
    let cameraInitialized = false;
    let processedCustomers = new Set();

    // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('å…¥å ´ç®¡ç†ã‚¢ãƒ—ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
      
      // ç”»é¢è¦ç´ ã®å–å¾—
      const mainScreen = document.getElementById('mainScreen');
      const qrScanScreen = document.getElementById('qrScanScreen');
      const manualEntryScreen = document.getElementById('manualEntryScreen');
      const customerInfoScreen = document.getElementById('customerInfoScreen');
      const completionScreen = document.getElementById('completionScreen');
      const dataMenuScreen = document.getElementById('dataMenuScreen');
      const customerListScreen = document.getElementById('customerListScreen');
      const entryListScreen = document.getElementById('entryListScreen');
      const loading = document.getElementById('loading');
      
      // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      loadStoredData();
      updateStats();
      
      // ç”»é¢åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
      function showScreen(screenId) {
        console.log('ç”»é¢åˆ‡ã‚Šæ›¿ãˆ:', screenId);
        
        // å…¨ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
        const screens = [mainScreen, qrScanScreen, manualEntryScreen, customerInfoScreen, 
                        completionScreen, dataMenuScreen, customerListScreen, entryListScreen];
        screens.forEach(screen => {
          if (screen) screen.classList.add('hidden');
        });
        
        // æŒ‡å®šã•ã‚ŒãŸç”»é¢ã‚’è¡¨ç¤º
        const targetScreen = document.getElementById(screenId);
        if (targetScreen) {
          targetScreen.classList.remove('hidden');
        }
      }
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º/éè¡¨ç¤º
      function showLoading() {
        loading.classList.remove('hidden');
      }
      
      function hideLoading() {
        loading.classList.add('hidden');
      }
      
      // Google Sheets ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      async function fetchCustomerData() {
        try {
          showLoading();
          console.log('Google Sheetsã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...');
          
          const response = await fetch(CONFIG.GOOGLE_APPS_SCRIPT_URL + '?action=getCustomers');
          const data = await response.json();
          
          if (data.success) {
            customerData = data.customers || [];
            localStorage.setItem(CONFIG.CUSTOMER_STORAGE_KEY, JSON.stringify(customerData));
            console.log(`${customerData.length}ä»¶ã®é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—`);
            updateStats();
            return true;
          } else {
            throw new Error(data.error || 'ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
          }
        } catch (error) {
          console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
          // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
          customerData = [
            {
              ticketNumber: '634',
              name: 'ãƒ†ã‚¹ãƒˆ å¤ªéƒ',
              email: 'test1@example.com',
              ticketCount: 2,
              seatNumber: 'A-12'
            },
            {
              ticketNumber: '183',
              name: 'ã‚µãƒ³ãƒ—ãƒ« èŠ±å­',
              email: 'test2@example.com',
              ticketCount: 1,
              seatNumber: 'B-05'
            },
            {
              ticketNumber: '631',
              name: 'ãƒ‡ãƒ¢ æ¬¡éƒ',
              email: 'test3@example.com',
              ticketCount: 3,
              seatNumber: 'C-08'
            }
          ];
          localStorage.setItem(CONFIG.CUSTOMER_STORAGE_KEY, JSON.stringify(customerData));
          alert('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¦ã„ã¾ã™\nã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™');
          updateStats();
          return false;
        } finally {
          hideLoading();
        }
      }
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      function loadStoredData() {
        const storedCustomers = localStorage.getItem(CONFIG.CUSTOMER_STORAGE_KEY);
        const storedEntries = localStorage.getItem(CONFIG.STORAGE_KEY);
        
        if (storedCustomers) {
          customerData = JSON.parse(storedCustomers);
        }
        
        if (storedEntries) {
          entryData = JSON.parse(storedEntries);
          // Set processed customers
          entryData.forEach(entry => {
            processedCustomers.add(entry.ticketNumber);
          });
        }
        
        console.log(`ä¿å­˜æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿: é¡§å®¢${customerData.length}ä»¶, å…¥å ´è¨˜éŒ²${entryData.length}ä»¶`);
      }
      
      // çµ±è¨ˆæƒ…å ±æ›´æ–°
      function updateStats() {
        const entryCountElement = document.getElementById('entryCount');
        const totalTicketsElement = document.getElementById('totalTickets');
        
        const totalEntries = entryData.reduce((sum, entry) => sum + (entry.entryCount || 1), 0);
        const totalTickets = customerData.reduce((sum, customer) => sum + (customer.ticketCount || 1), 0);
        
        if (entryCountElement) entryCountElement.textContent = totalEntries;
        if (totalTicketsElement) totalTicketsElement.textContent = totalTickets;
      }
      
      // QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Šé–‹å§‹
      function startQRScanner() {
        console.log('QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼é–‹å§‹');
        
        if (!html5QrCode) {
          html5QrCode = new Html5Qrcode("qrReader");
        }
        
        const config = {
          fps: 10,
          qrbox: { width: 250, height: 250 },
          aspectRatio: 1.0
        };
        
        Html5Qrcode.getCameras().then(cameras => {
          if (cameras && cameras.length) {
            const cameraId = cameras[0].id;
            
            html5QrCode.start(cameraId, config, onScanSuccess, onScanFailure)
              .then(() => {
                console.log('QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼é–‹å§‹æˆåŠŸ');
                isScanning = true;
                cameraInitialized = true;
                updateScanStatus('QRã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã¦ãã ã•ã„', 'scanning');
              })
              .catch(err => {
                console.error('QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼é–‹å§‹ã‚¨ãƒ©ãƒ¼:', err);
                updateScanStatus('ã‚«ãƒ¡ãƒ©ã®èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                alert('ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒå¿…è¦ã§ã™ã€‚\nãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
              });
          } else {
            alert('ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
          }
        }).catch(err => {
          console.error('ã‚«ãƒ¡ãƒ©å–å¾—ã‚¨ãƒ©ãƒ¼:', err);
          alert('ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        });
      }
      
      // QRã‚¹ã‚­ãƒ£ãƒ³æˆåŠŸæ™‚ã®å‡¦ç†
      function onScanSuccess(decodedText, decodedResult) {
        console.log('QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚ŠæˆåŠŸ:', decodedText);
        
        if (isPaused) return;
        
        updateScanStatus('QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸ', 'success');
        
        // é¡§å®¢æ¤œç´¢
        const customer = findCustomer(decodedText);
        if (customer) {
          displayCustomerInfo(customer);
          showScreen('customerInfoScreen');
          
          if (!continuousScanMode) {
            pauseQRScanner();
          }
        } else {
          updateScanStatus('è©²å½“ã™ã‚‹é¡§å®¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
          setTimeout(() => {
            if (isScanning && !isPaused) {
              updateScanStatus('QRã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã¦ãã ã•ã„', 'scanning');
            }
          }, 2000);
        }
      }
      
      // QRã‚¹ã‚­ãƒ£ãƒ³å¤±æ•—æ™‚ã®å‡¦ç†
      function onScanFailure(error) {
        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¡¨ç¤ºã—ãªã„ï¼ˆé€šå¸¸ã®å‹•ä½œï¼‰
      }
      
      // ã‚¹ã‚­ãƒ£ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
      function updateScanStatus(message, type = '') {
        const statusElement = document.getElementById('qrScanStatus');
        if (statusElement) {
          statusElement.textContent = message;
          statusElement.className = 'scan-status ' + type;
        }
      }
      
      // QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼ä¸€æ™‚åœæ­¢
      function pauseQRScanner() {
        if (html5QrCode && isScanning && !isPaused) {
          html5QrCode.pause();
          isPaused = true;
          updateScanStatus('ã‚¹ã‚­ãƒ£ãƒ³ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ', 'paused');
          console.log('QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼ä¸€æ™‚åœæ­¢');
        }
      }
      
      // QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼å†é–‹
      function resumeQRScanner() {
        if (html5QrCode && isScanning && isPaused) {
          html5QrCode.resume();
          isPaused = false;
          updateScanStatus('QRã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã¦ãã ã•ã„', 'scanning');
          console.log('QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼å†é–‹');
        }
      }
      
      // QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼åœæ­¢
      function stopQRScanner() {
        if (html5QrCode && isScanning) {
          html5QrCode.stop().then(() => {
            console.log('QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼åœæ­¢');
            isScanning = false;
            isPaused = false;
            cameraInitialized = false;
          }).catch(err => {
            console.error('QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼åœæ­¢ã‚¨ãƒ©ãƒ¼:', err);
          });
        }
      }
      
      // é¡§å®¢æ¤œç´¢
      function findCustomer(query) {
        return customerData.find(customer => 
          customer.ticketNumber === query || 
          customer.name.includes(query) || 
          customer.email.includes(query)
        );
      }
      
      // é¡§å®¢æƒ…å ±è¡¨ç¤º
      function displayCustomerInfo(customer) {
        document.getElementById('customerTicket').textContent = customer.ticketNumber || '-';
        document.getElementById('customerName').textContent = customer.name || '-';
        document.getElementById('customerEmail').textContent = customer.email || '-';
        document.getElementById('customerTickets').textContent = customer.ticketCount || '-';
        document.getElementById('customerSeat').textContent = customer.seatNumber || '-';
        
        // å…¥å ´å±¥æ­´è¡¨ç¤º
        const entryHistory = entryData.filter(entry => entry.ticketNumber === customer.ticketNumber);
        if (entryHistory.length > 0) {
          const historyElement = document.getElementById('entryHistory');
          const historyListElement = document.getElementById('entryHistoryList');
          
          historyElement.classList.remove('hidden');
          historyListElement.innerHTML = entryHistory.map(entry =>
            `<p><strong>${entry.entryTime}</strong> - ${entry.entryCount}å</p>`
          ).join('');
        }
      }
      
      // å…¥å ´è¨˜éŒ²ä¿å­˜
      async function saveEntry(customer, entryCount) {
        const entry = {
          ticketNumber: customer.ticketNumber,
          customerName: customer.name,
          entryCount: parseInt(entryCount),
          entryTime: new Date().toISOString(),
          timestamp: Date.now()
        };
        
        entryData.push(entry);
        processedCustomers.add(customer.ticketNumber);
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
        localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(entryData));
        
        // Google Sheetsã«é€ä¿¡
        try {
          const response = await fetch(CONFIG.GOOGLE_APPS_SCRIPT_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
              action: 'addEntry',
              ...entry
            })
          });
          
          const result = await response.json();
          if (result.success) {
            console.log('å…¥å ´è¨˜éŒ²ã‚’Google Sheetsã«ä¿å­˜ã—ã¾ã—ãŸ');
          }
        } catch (error) {
          console.error('Google Sheetsä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        }
        
        updateStats();
        return entry;
      }
      
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
      setupEventListeners();
      
      function setupEventListeners() {
        // ãƒ¡ã‚¤ãƒ³ç”»é¢ã®ãƒœã‚¿ãƒ³
        const startQRScanBtn = document.getElementById('startQRScan');
        if (startQRScanBtn) {
          startQRScanBtn.addEventListener('click', function() {
            console.log('QRã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹');
            showScreen('qrScanScreen');
            startQRScanner();
          });
        }
        
        const manualEntryBtn = document.getElementById('manualEntry');
        if (manualEntryBtn) {
          manualEntryBtn.addEventListener('click', function() {
            showScreen('manualEntryScreen');
          });
        }
        
        const updateBtn = document.getElementById('updateBtn');
        if (updateBtn) {
          updateBtn.addEventListener('click', async function() {
            await fetchCustomerData();
            alert('ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
          });
        }
        
        const menuBtn = document.getElementById('menuBtn');
        if (menuBtn) {
          menuBtn.addEventListener('click', function() {
            showScreen('dataMenuScreen');
          });
        }
        
        // QRã‚¹ã‚­ãƒ£ãƒ³ç”»é¢ã®ãƒœã‚¿ãƒ³
        const stopQRScanBtn = document.getElementById('stopQRScan');
        if (stopQRScanBtn) {
          stopQRScanBtn.addEventListener('click', function() {
            stopQRScanner();
            showScreen('mainScreen');
          });
        }
        
        const pauseResumeBtn = document.getElementById('pauseResumeBtn');
        if (pauseResumeBtn) {
          pauseResumeBtn.addEventListener('click', function() {
            if (isPaused) {
              resumeQRScanner();
              pauseResumeBtn.innerHTML = 'â¸ï¸ ä¸€æ™‚åœæ­¢';
            } else {
              pauseQRScanner();
              pauseResumeBtn.innerHTML = 'â–¶ï¸ å†é–‹';
            }
          });
        }
        
        const continuousModeBtn = document.getElementById('continuousModeBtn');
        if (continuousModeBtn) {
          continuousModeBtn.addEventListener('click', function() {
            continuousScanMode = !continuousScanMode;
            if (continuousScanMode) {
              continuousModeBtn.innerHTML = 'ğŸ”„ é€£ç¶šã‚¹ã‚­ãƒ£ãƒ³: ON';
            } else {
              continuousModeBtn.innerHTML = 'ğŸ”„ é€£ç¶šã‚¹ã‚­ãƒ£ãƒ³: OFF';
            }
          });
        }
        
        const switchToManualBtn = document.getElementById('switchToManual');
        if (switchToManualBtn) {
          switchToManualBtn.addEventListener('click', function() {
            stopQRScanner();
            showScreen('manualEntryScreen');
          });
        }
        
        // æ‰‹å‹•å…¥åŠ›ç”»é¢ã®ãƒœã‚¿ãƒ³
        const backToMainBtn = document.getElementById('backToMain');
        if (backToMainBtn) {
          backToMainBtn.addEventListener('click', function() {
            showScreen('mainScreen');
          });
        }
        
        const searchButton = document.getElementById('searchButton');
        if (searchButton) {
          searchButton.addEventListener('click', function() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput ? searchInput.value.trim() : '';
            
            if (!query) {
              alert('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
              return;
            }
            
            const customer = findCustomer(query);
            if (customer) {
              displayCustomerInfo(customer);
              showScreen('customerInfoScreen');
            } else {
              alert('è©²å½“ã™ã‚‹é¡§å®¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
            }
          });
        }
        
        // é¡§å®¢æƒ…å ±ç”»é¢ã®ãƒœã‚¿ãƒ³
        const backToSearchBtn = document.getElementById('backToSearch');
        if (backToSearchBtn) {
          backToSearchBtn.addEventListener('click', function() {
            showScreen('manualEntryScreen');
          });
        }
        
        const confirmEntryBtn = document.getElementById('confirmEntry');
        if (confirmEntryBtn) {
          confirmEntryBtn.addEventListener('click', async function() {
            const entryCount = parseInt(document.getElementById('entryCountInput').value);
            const customerTicket = document.getElementById('customerTicket').textContent;
            const customerName = document.getElementById('customerName').textContent;
            
            if (!customerTicket || customerTicket === '-') {
              alert('é¡§å®¢æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');
              return;
            }
            
            const customer = {
              ticketNumber: customerTicket,
              name: customerName
            };
            
            try {
              showLoading();
              const entry = await saveEntry(customer, entryCount);
              
              // å®Œäº†ç”»é¢ã«é·ç§»
              document.getElementById('completedCustomerName').textContent = customerName;
              document.getElementById('completedTicketNumber').textContent = customerTicket;
              document.getElementById('completedTickets').textContent = entryCount;
              document.getElementById('entryTime').textContent = new Date().toLocaleString('ja-JP');
              
              showScreen('completionScreen');
            } catch (error) {
              console.error('å…¥å ´å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
              alert('å…¥å ´å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
            } finally {
              hideLoading();
            }
          });
        }
        
        // å®Œäº†ç”»é¢ã®ãƒœã‚¿ãƒ³
        const nextCustomerBtn = document.getElementById('nextCustomer');
        if (nextCustomerBtn) {
          nextCustomerBtn.addEventListener('click', function() {
            if (continuousScanMode && cameraInitialized) {
              showScreen('qrScanScreen');
              resumeQRScanner();
            } else {
              showScreen('mainScreen');
            }
          });
        }
        
        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒœã‚¿ãƒ³
        const backToMainFromMenuBtn = document.getElementById('backToMainFromMenu');
        if (backToMainFromMenuBtn) {
          backToMainFromMenuBtn.addEventListener('click', function() {
            showScreen('mainScreen');
          });
        }
        
        const viewCustomersBtn = document.getElementById('viewCustomersBtn');
        if (viewCustomersBtn) {
          viewCustomersBtn.addEventListener('click', function() {
            displayCustomerList();
            showScreen('customerListScreen');
          });
        }
        
        const viewEntriesBtn = document.getElementById('viewEntriesBtn');
        if (viewEntriesBtn) {
          viewEntriesBtn.addEventListener('click', function() {
            displayEntryList();
            showScreen('entryListScreen');
          });
        }
        
        const exportDataBtn = document.getElementById('exportDataBtn');
        if (exportDataBtn) {
          exportDataBtn.addEventListener('click', function() {
            exportToCSV();
          });
        }
        
        const clearDataBtn = document.getElementById('clearDataBtn');
        if (clearDataBtn) {
          clearDataBtn.addEventListener('click', function() {
            if (confirm('å…¥å ´è¨˜éŒ²ã‚’å…¨ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
              entryData = [];
              processedCustomers.clear();
              localStorage.removeItem(CONFIG.STORAGE_KEY);
              updateStats();
              alert('å…¥å ´è¨˜éŒ²ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
            }
          });
        }
        
        // é¡§å®¢ä¸€è¦§ç”»é¢ã®ãƒœã‚¿ãƒ³
        const backToMenuFromCustomersBtn = document.getElementById('backToMenuFromCustomers');
        if (backToMenuFromCustomersBtn) {
          backToMenuFromCustomersBtn.addEventListener('click', function() {
            showScreen('dataMenuScreen');
          });
        }
        
        // å…¥å ´è¨˜éŒ²ä¸€è¦§ç”»é¢ã®ãƒœã‚¿ãƒ³
        const backToMenuFromEntriesBtn = document.getElementById('backToMenuFromEntries');
        if (backToMenuFromEntriesBtn) {
          backToMenuFromEntriesBtn.addEventListener('click', function() {
            showScreen('dataMenuScreen');
          });
        }
        
        // ãƒœã‚¿ãƒ³ã«ã‚¯ãƒªãƒƒã‚¯æ™‚ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¿½åŠ 
        const allButtons = document.querySelectorAll('button');
        allButtons.forEach((button) => {
          button.addEventListener('click', function() {
            button.style.transform = 'scale(0.95)';
            setTimeout(() => {
              button.style.transform = '';
            }, 150);
          });
        });
      }
      
      // é¡§å®¢ä¸€è¦§è¡¨ç¤º
      function displayCustomerList() {
        const customerList = document.getElementById('customerList');
        const customerListStats = document.getElementById('customerListStats');
        
        if (!customerList || !customerListStats) return;
        
        const enteredCount = customerData.filter(customer => 
          processedCustomers.has(customer.ticketNumber)
        ).length;
        
        customerListStats.textContent = `å…¨${customerData.length}ä»¶ä¸­ ${enteredCount}ä»¶å…¥å ´æ¸ˆã¿`;
        
        if (customerData.length === 0) {
          customerList.innerHTML = '<div class="no-data">é¡§å®¢ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
          return;
        }
        
        customerList.innerHTML = customerData.map(customer => {
          const isEntered = processedCustomers.has(customer.ticketNumber);
          return `
            <div class="list-item">
              <div class="list-item-header">
                <span class="customer-name">${customer.name}</span>
                <span class="entry-status ${isEntered ? 'entered' : 'pending'}">
                  ${isEntered ? 'å…¥å ´æ¸ˆã¿' : 'æœªå…¥å ´'}
                </span>
              </div>
              <div class="list-item-details">
                ãƒã‚±ãƒƒãƒˆç•ªå·: ${customer.ticketNumber}<br>
                ãƒ¡ãƒ¼ãƒ«: ${customer.email}<br>
                è³¼å…¥æšæ•°: ${customer.ticketCount}æš | åº§å¸­: ${customer.seatNumber}
              </div>
            </div>
          `;
        }).join('');
      }
      
      // å…¥å ´è¨˜éŒ²ä¸€è¦§è¡¨ç¤º
      function displayEntryList() {
        const entryList = document.getElementById('entryList');
        const entryListStats = document.getElementById('entryListStats');
        
        if (!entryList || !entryListStats) return;
        
        const totalEntries = entryData.reduce((sum, entry) => sum + (entry.entryCount || 1), 0);
        entryListStats.textContent = `å…¨${entryData.length}ä»¶ã®è¨˜éŒ² (å…¥å ´è€…æ•°: ${totalEntries}å)`;
        
        if (entryData.length === 0) {
          entryList.innerHTML = '<div class="no-data">å…¥å ´è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';
          return;
        }
        
        const sortedEntries = [...entryData].reverse(); // æœ€æ–°é †
        
        entryList.innerHTML = sortedEntries.map(entry => `
          <div class="list-item">
            <div class="list-item-header">
              <span class="customer-name">${entry.customerName}</span>
              <span class="entry-status entered">${entry.entryCount}å</span>
            </div>
            <div class="list-item-details">
              ãƒã‚±ãƒƒãƒˆç•ªå·: ${entry.ticketNumber}<br>
              å…¥å ´æ™‚åˆ»: ${new Date(entry.entryTime).toLocaleString('ja-JP')}
            </div>
          </div>
        `).join('');
      }
      
      // CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      function exportToCSV() {
        if (entryData.length === 0) {
          alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹å…¥å ´è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“');
          return;
        }
        
        const headers = ['ãƒã‚±ãƒƒãƒˆç•ªå·', 'é¡§å®¢å', 'å…¥å ´äººæ•°', 'å…¥å ´æ™‚åˆ»'];
        const csvContent = [
          headers.join(','),
          ...entryData.map(entry => [
            entry.ticketNumber,
            entry.customerName,
            entry.entryCount,
            new Date(entry.entryTime).toLocaleString('ja-JP')
          ].join(','))
        ].join('\n');
        
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.setAttribute('href', url);
        link.setAttribute('download', `å…¥å ´è¨˜éŒ²_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
      }
      
      // åˆæœŸåŒ–å®Œäº†
      console.log('å…¥å ´ç®¡ç†ã‚¢ãƒ—ãƒªã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ');
      
      // åˆå›ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      if (customerData.length === 0) {
        fetchCustomerData();
      }
    });
  </script>
</body>
</html>
